<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Kasir</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Aplikasi Kasir</h1>

        <!-- Supplier Input -->
        <div class="mb-4">
            <h5>Pengelolaan Supplier</h5>
            <div class="mb-3">
                <label for="supplierName">Nama Supplier</label>
                <input type="text" id="supplierName" class="form-control">
            </div>
            <div class="mb-3">
                <label for="supplierContact">Kontak Supplier</label>
                <input type="text" id="supplierContact" class="form-control">
            </div>
            <button id="addSupplierButton" class="btn btn-primary mt-2">Tambah Supplier</button>
            <ul id="supplierList" class="list-group mt-3"></ul>
        </div>

        <!-- Produk Input -->
        <div class="mb-4">
            <h5>Tambah Produk</h5>
            <div class="mb-3">
                <label for="productName">Nama Produk</label>
                <input type="text" id="productName" class="form-control">
            </div>
            <div class="mb-3">
                <label for="productCategory">Kategori Produk</label>
                <input type="text" id="productCategory" class="form-control">
            </div>
            <div class="mb-3">
                <label for="productPrice">Harga Produk</label>
                <input type="number" id="productPrice" class="form-control" step="0.01" min="0" placeholder="Masukkan harga produk" required>
            </div>
            <div class="mb-3">
                <label for="productQuantity">Jumlah Produk</label>
                <input type="number" id="productQuantity" class="form-control" min="1" placeholder="Masukkan jumlah produk" required>
            </div>
            <button id="addProductButton" class="btn btn-primary mt-2">Tambah Produk</button>
            <div id="productEditContainer" class="mt-3 d-none"></div>
        </div>

        <!-- Keranjang Belanja -->
        <div class="mb-4">
            <h5>Keranjang Belanja</h5>
            <ul id="cartList" class="list-group mt-3"></ul>
            <div class="mt-3">
                <button id="checkoutButton" class="btn btn-success">Proses Checkout</button>
            </div>
        </div>

        <!-- Transaksi -->
        <div class="mb-4">
            <h5>Transaksi</h5>
            <div class="mb-3">
                <label for="selectProduct">Pilih Produk</label>
                <select id="selectProduct" class="form-select">
                    <option value="">Pilih Produk</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="transactionQuantity">Jumlah</label>
                <input type="number" id="transactionQuantity" class="form-control">
            </div>
            <div class="mb-3">
                <label for="paymentMethod">Metode Pembayaran</label>
                <select id="paymentMethod" class="form-select">
                    <option value="cash">Cash</option>
                    <option value="transfer">Transfer</option>
                    <option value="e-wallet">E-Wallet</option>
                </select>
            </div>
            <button id="processTransactionButton" class="btn btn-primary mt-2">Proses Transaksi</button>
        </div>

        <!-- Riwayat Transaksi -->
        <div class="mb-4">
            <h5>Riwayat Transaksi</h5>
            <ul id="transactionHistory" class="list-group mt-3"></ul>
        </div>

        <!-- Invoice -->
        <div class="mb-4">
            <h5>Invoice</h5>
            <button id="generateInvoiceButton" class="btn btn-success mt-2">Buat Invoice</button>
            <div id="invoiceContainer" class="mt-3"></div>
        </div>

        <!-- Laporan -->
        <div class="mb-4">
            <h5>Laporan</h5>
            <div class="mb-3">
                <label for="reportByCategory">Pilih Kategori untuk Laporan</label>
                <select id="reportByCategory" class="form-select">
                    <option value="all">Semua Kategori</option>
                </select>
            </div>
            <button id="generateReportButton" class="btn btn-success mt-2">Unduh Laporan</button>
            <button id="generatePDFButton" class="btn btn-info mt-2">Unduh PDF Laporan</button>
        </div>

        <!-- Struk -->
        <div class="mb-4">
            <h5>Struk</h5>
            <div class="mt-3">
                <button id="printReceiptButton" class="btn btn-primary mt-2">Cetak Struk</button>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script>
        let suppliers = JSON.parse(localStorage.getItem("suppliers")) || [];
        let products = JSON.parse(localStorage.getItem("products")) || [];
        let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
        let cart = [];

        // Fungsi untuk menampilkan notifikasi
        function showNotification(message, type) {
            alert(`${type.toUpperCase()}: ${message}`);
        }

        // Render supplier list
        function renderSupplierList() {
            const supplierList = document.getElementById("supplierList");
            supplierList.innerHTML = "";
            suppliers.forEach((supplier, index) => {
                const li = document.createElement("li");
                li.className = "list-group-item d-flex justify-content-between align-items-center";
                li.innerHTML = `${supplier.name} - ${supplier.contact} <button class="btn btn-danger btn-sm" onclick="deleteSupplier(${index})">Hapus</button>`;
                supplierList.appendChild(li);
            });
        }

        // Add Supplier
        document.getElementById("addSupplierButton").addEventListener("click", () => {
            const name = document.getElementById("supplierName").value.trim();
            const contact = document.getElementById("supplierContact").value.trim();

            if (!name || !contact) {
                showNotification("Mohon isi semua field dengan benar.", "danger");
                return;
            }

            suppliers.push({ name, contact });
            localStorage.setItem("suppliers", JSON.stringify(suppliers));
            renderSupplierList();
            showNotification("Supplier berhasil ditambahkan.", "success");

            document.getElementById("supplierName").value = "";
            document.getElementById("supplierContact").value = "";
        });

        // Render Product Select
        function renderProductSelect() {
            const selectProduct = document.getElementById("selectProduct");
            selectProduct.innerHTML = "<option value=''>Pilih Produk</option>";
            products.forEach((product, index) => {
                const option = document.createElement("option");
                option.value = index;
                option.textContent = `${product.name} - ${product.category} - Rp${product.price}`;
                selectProduct.appendChild(option);
            });
        }

        // Add Product
        document.getElementById("addProductButton").addEventListener("click", () => {
            const name = document.getElementById("productName").value.trim();
            const category = document.getElementById("productCategory").value.trim();
            const price = parseFloat(document.getElementById("productPrice").value);
            const quantity = parseInt(document.getElementById("productQuantity").value, 10);

            if (!name || !category || isNaN(price) || isNaN(quantity) || price <= 0 || quantity <= 0) {
                showNotification("Mohon isi semua field dengan benar.", "danger");
                return;
            }

            products.push({ name, category, price, quantity });
            localStorage.setItem("products", JSON.stringify(products));
            showNotification("Produk berhasil ditambahkan.", "success");

            document.getElementById("productName").value = "";
            document.getElementById("productCategory").value = "";
            document.getElementById("productPrice").value = "";
            document.getElementById("productQuantity").value = "";

            renderProductSelect();
        });

        // Edit Product
        document.getElementById("productEditContainer").addEventListener("submit", event => {
            event.preventDefault();
            const productIndex = parseInt(document.getElementById("productEditIndex").value);
            const name = document.getElementById("editProductName").value.trim();
            const category = document.getElementById("editProductCategory").value.trim();
            const price = parseFloat(document.getElementById("editProductPrice").value);
            const quantity = parseInt(document.getElementById("editProductQuantity").value, 10);

            if (!name || !category || isNaN(price) || isNaN(quantity) || price <= 0 || quantity <= 0) {
                showNotification("Mohon isi semua field dengan benar.", "danger");
                return;
            }

            products[productIndex] = { name, category, price, quantity };
            localStorage.setItem("products", JSON.stringify(products));
            renderProductSelect();
            showNotification("Produk berhasil diperbarui.", "success");
            document.getElementById("productEditContainer").classList.add('d-none');
        });

        // Delete Supplier
        function deleteSupplier(index) {
            suppliers.splice(index, 1);
            localStorage.setItem("suppliers", JSON.stringify(suppliers));
            renderSupplierList();
        }

        // Render Transaction History
        function renderTransactionHistory() {
            const transactionHistory = document.getElementById("transactionHistory");
            transactionHistory.innerHTML = "";
            transactions.forEach((transaction, index) => {
                const li = document.createElement("li");
                li.className = "list-group-item";
                li.innerHTML = `
                    Produk: ${transaction.product.name} <br>
                    Jumlah: ${transaction.quantity} <br>
                    Total: Rp${transaction.totalPrice} <br>
                    Metode Pembayaran: ${transaction.paymentMethod} <br>
                    Tanggal: ${transaction.date}
                `;
                transactionHistory.appendChild(li);
            });
        }

        // Process Transaction
        document.getElementById("processTransactionButton").addEventListener("click", () => {
            const productIndex = parseInt(document.getElementById("selectProduct").value);
            const quantity = parseInt(document.getElementById("transactionQuantity").value, 10);
            const paymentMethod = document.getElementById("paymentMethod").value;

            if (isNaN(productIndex) || isNaN(quantity) || quantity <= 0 || !paymentMethod) {
                showNotification("Mohon isi semua field dengan benar.", "danger");
                return;
            }

            const product = products[productIndex];
            if (product.quantity < quantity) {
                showNotification("Jumlah yang dimasukkan melebihi stok tersedia.", "danger");
                return;
            }

            const totalPrice = product.price * quantity;
            product.quantity -= quantity;
            transactions.push({ product, quantity, paymentMethod, totalPrice, date: new Date().toLocaleString() });
            localStorage.setItem("products", JSON.stringify(products));
            localStorage.setItem("transactions", JSON.stringify(transactions));

            showNotification("Transaksi berhasil diproses.", "success");
            renderTransactionHistory();
        });

        // Add to Cart
        document.getElementById("selectProduct").addEventListener("change", function() {
            const productIndex = parseInt(this.value);
            const quantity = parseInt(document.getElementById("transactionQuantity").value, 10);
            if (!productIndex || !quantity || quantity <= 0) return;

            const product = products[productIndex];
            if (product.quantity < quantity) {
                showNotification("Jumlah yang dimasukkan melebihi stok tersedia.", "danger");
                return;
            }

            const existingProductIndex = cart.findIndex(item => item.productIndex === productIndex);
            if (existingProductIndex > -1) {
                cart[existingProductIndex].quantity += quantity;
            } else {
                cart.push({ productIndex, quantity });
            }
            
            localStorage.setItem("cart", JSON.stringify(cart));
            renderCart();
        });

        // Render Cart
        function renderCart() {
            const cartList = document.getElementById("cartList");
            cartList.innerHTML = "";
            cart.forEach((item, index) => {
                const product = products[item.productIndex];
                const li = document.createElement("li");
                li.className = "list-group-item d-flex justify-content-between align-items-center";
                li.innerHTML = `
                    ${product.name} - ${product.quantity} - Rp${product.price * item.quantity}
                    <button class="btn btn-danger btn-sm" onclick="removeFromCart(${index})">Hapus</button>
                `;
                cartList.appendChild(li);
            });
        }

        // Remove from Cart
        function removeFromCart(index) {
            cart.splice(index, 1);
            localStorage.setItem("cart", JSON.stringify(cart));
            renderCart();
        }

        // Checkout
        document.getElementById("checkoutButton").addEventListener("click", () => {
            transactions = [...transactions, ...cart.map(item => {
                const product = products[item.productIndex];
                const totalPrice = product.price * item.quantity;
                product.quantity -= item.quantity;
                return { product, quantity: item.quantity, paymentMethod: "cash", totalPrice, date: new Date().toLocaleString() };
            })];

            localStorage.setItem("products", JSON.stringify(products));
            localStorage.setItem("transactions", JSON.stringify(transactions));
            cart = [];
            localStorage.setItem("cart", JSON.stringify(cart));
            showNotification("Checkout berhasil diproses.", "success");
            renderTransactionHistory();
            renderCart();
        });

        // Generate Report
        document.getElementById("generateReportButton").addEventListener("click", () => {
            const reportByCategory = document.getElementById("reportByCategory").value;
            let filteredProducts;

            if (reportByCategory === "all") {
                filteredProducts = products;
            } else {
                filteredProducts = products.filter(p => p.category === reportByCategory);
            }

            generateReport(filteredProducts);
        });

        function generateReport(data) {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Nama Produk,Kategori,Harga,Jumlah,Total\n";
            data.forEach(product => {
                const totalPrice = product.price * product.quantity;
                csvContent += `${product.name},${product.category},${product.price},${product.quantity},${totalPrice}\n`;
            });

            const encodedUri = encodeURI(csvContent);
            window.open(encodedUri);
        }

        // Generate PDF Report
        document.getElementById("generatePDFButton").addEventListener("click", () => {
            const reportByCategory = document.getElementById("reportByCategory").value;
            let filteredProducts;

            if (reportByCategory === "all") {
                filteredProducts = products;
            } else {
                filteredProducts = products.filter(p => p.category === reportByCategory);
            }

            generatePDF(filteredProducts);
        });

        function generatePDF(data) {
            let pdfContent = `<h1>Laporan Produk</h1>`;
            pdfContent += "<table class='table table-bordered'>";
            pdfContent += "<thead><tr><th>Nama Produk</th><th>Kategori</th><th>Harga</th><th>Jumlah</th><th>Total</th></tr></thead><tbody>";

            data.forEach(product => {
                const totalPrice = product.price * product.quantity;
                pdfContent += `<tr><td>${product.name}</td><td>${product.category}</td><td>${product.price}</td><td>${product.quantity}</td><td>${totalPrice}</td></tr>`;
            });

            pdfContent += "</tbody></table>";

            const pdfWindow = window.open('', '_blank');
            pdfWindow.document.write(pdfContent);
            pdfWindow.document.close();
            pdfWindow.print();
        }

        // Print Receipt
        document.getElementById("printReceiptButton").addEventListener("click", () => {
            let receiptContent = `<h1>Struk Transaksi</h1>`;
            receiptContent += "<ul class='list-group'>";

            transactions.forEach(transaction => {
                receiptContent += `<li class='list-group-item'>Produk: ${transaction.product.name}<br>Jumlah: ${transaction.quantity}<br>Total: Rp${transaction.totalPrice}<br>Metode Pembayaran: ${transaction.paymentMethod}<br>Tanggal: ${transaction.date}</li>`;
            });

            receiptContent += "</ul>";

            const receiptWindow = window.open('', '_blank');
            receiptWindow.document.write(receiptContent);
            receiptWindow.document.close();
            receiptWindow.print();
        });

        // Initial Render
        renderSupplierList();
        renderProductSelect();
        renderTransactionHistory();
        renderCart();
    </script>
</body>
</html>
