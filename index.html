<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Kasir</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Aplikasi Kasir</h1>

        <!-- Supplier Input -->
        <div class="mb-4">
            <h5>Pengelolaan Supplier</h5>
            <div class="mb-3">
                <label for="supplierName">Nama Supplier</label>
                <input type="text" id="supplierName" class="form-control">
            </div>
            <div class="mb-3">
                <label for="supplierContact">Kontak Supplier</label>
                <input type="text" id="supplierContact" class="form-control">
            </div>
            <button id="addSupplierButton" class="btn btn-primary mt-2">Tambah Supplier</button>
            <ul id="supplierList" class="list-group mt-3"></ul>
        </div>

        <!-- Produk Input -->
        <div class="mb-4">
            <h5>Tambah Produk</h5>
            <div class="mb-3">
                <label for="productName">Nama Produk</label>
                <input type="text" id="productName" class="form-control">
            </div>
            <div class="mb-3">
                <label for="productCategory">Kategori Produk</label>
                <input type="text" id="productCategory" class="form-control">
            </div>
            <div class="mb-3">
                <label for="productPrice">Harga Produk</label>
                <input type="number" id="productPrice" class="form-control" step="0.01">
            </div>
            <div class="mb-3">
                <label for="productQuantity">Jumlah Produk</label>
                <input type="number" id="productQuantity" class="form-control">
            </div>
            <button id="addProductButton" class="btn btn-primary mt-2">Tambah Produk</button>
        </div>

        <!-- Transaksi -->
        <div class="mb-4">
            <h5>Transaksi</h5>
            <div class="mb-3">
                <label for="selectProduct">Pilih Produk</label>
                <select id="selectProduct" class="form-select">
                    <option value="">Pilih Produk</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="transactionQuantity">Jumlah</label>
                <input type="number" id="transactionQuantity" class="form-control">
            </div>
            <div class="mb-3">
                <label for="paymentMethod">Metode Pembayaran</label>
                <select id="paymentMethod" class="form-select">
                    <option value="cash">Cash</option>
                    <option value="transfer">Transfer</option>
                    <option value="e-wallet">E-Wallet</option>
                </select>
            </div>
            <button id="processTransactionButton" class="btn btn-primary mt-2">Proses Transaksi</button>
        </div>

        <!-- Riwayat Transaksi -->
        <div class="mb-4">
            <h5>Riwayat Transaksi</h5>
            <ul id="transactionHistory" class="list-group mt-3"></ul>
        </div>

        <!-- Laporan -->
        <div class="mb-4">
            <h5>Laporan</h5>
            <div class="mb-3">
                <label for="reportByCategory">Pilih Kategori untuk Laporan</label>
                <select id="reportByCategory" class="form-select">
                    <option value="all">Semua Kategori</option>
                </select>
            </div>
            <button id="generateReportButton" class="btn btn-success mt-2">Unduh Laporan</button>
        </div>

        <!-- Struk -->
        <div class="mb-4">
            <h5>Struk</h5>
            <div class="mt-3">
                <button id="printReceiptButton" class="btn btn-primary mt-2">Cetak Struk</button>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script>
        let suppliers = JSON.parse(localStorage.getItem("suppliers")) || [];
        let products = JSON.parse(localStorage.getItem("products")) || [];
        let transactions = JSON.parse(localStorage.getItem("transactions")) || [];

        // Fungsi untuk menampilkan notifikasi
        function showNotification(message, type) {
            alert(`${type.toUpperCase()}: ${message}`);
        }

        // Render supplier list
        function renderSupplierList() {
            const supplierList = document.getElementById("supplierList");
            supplierList.innerHTML = "";
            suppliers.forEach((supplier, index) => {
                const li = document.createElement("li");
                li.className = "list-group-item d-flex justify-content-between align-items-center";
                li.innerHTML = `${supplier.name} - ${supplier.contact} <button class="btn btn-danger btn-sm" onclick="deleteSupplier(${index})">Hapus</button>`;
                supplierList.appendChild(li);
            });
        }

        // Add Supplier
        document.getElementById("addSupplierButton").addEventListener("click", () => {
            const name = document.getElementById("supplierName").value.trim();
            const contact = document.getElementById("supplierContact").value.trim();

            if (!name || !contact) {
                showNotification("Mohon isi semua field dengan benar.", "danger");
                return;
            }

            suppliers.push({ name, contact });
            localStorage.setItem("suppliers", JSON.stringify(suppliers));
            renderSupplierList();
            showNotification("Supplier berhasil ditambahkan.", "success");

            document.getElementById("supplierName").value = "";
            document.getElementById("supplierContact").value = "";
        });

        // Render Product Select
        function renderProductSelect() {
            const selectProduct = document.getElementById("selectProduct");
            selectProduct.innerHTML = "<option value=''>Pilih Produk</option>";
            products.forEach((product, index) => {
                const option = document.createElement("option");
                option.value = index;
                option.textContent = `${product.name} - ${product.category} - Rp${product.price}`;
                selectProduct.appendChild(option);
            });
        }

        // Add Product
        document.getElementById("addProductButton").addEventListener("click", () => {
            const name = document.getElementById("productName").value.trim();
            const category = document.getElementById("productCategory").value.trim();
            const price = parseFloat(document.getElementById("productPrice").value);
            const quantity = parseInt(document.getElementById("productQuantity").value, 10);

            if (!name || !category || isNaN(price) || isNaN(quantity)) {
                showNotification("Mohon isi semua field dengan benar.", "danger");
                return;
            }

            products.push({ name, category, price, quantity });
            localStorage.setItem("products", JSON.stringify(products));
            showNotification("Produk berhasil ditambahkan.", "success");

            document.getElementById("productName").value = "";
            document.getElementById("productCategory").value = "";
            document.getElementById("productPrice").value = "";
            document.getElementById("productQuantity").value = "";

            renderProductSelect();
        });

        // Process Transaction
        document.getElementById("processTransactionButton").addEventListener("click", () => {
            const productIndex = parseInt(document.getElementById("selectProduct").value);
            const quantity = parseInt(document.getElementById("transactionQuantity").value, 10);
            const paymentMethod = document.getElementById("paymentMethod").value;

            if (isNaN(productIndex) || isNaN(quantity) || quantity <= 0 || !paymentMethod) {
                showNotification("Mohon isi semua field dengan benar.", "danger");
                return;
            }

            const product = products[productIndex];
            if (product.quantity < quantity) {
                showNotification("Jumlah yang dimasukkan melebihi stok tersedia.", "danger");
                return;
            }

            const totalPrice = product.price * quantity;
            product.quantity -= quantity;
            transactions.push({ product, quantity, paymentMethod, totalPrice, date: new Date().toLocaleString() });
            localStorage.setItem("products", JSON.stringify(products));
            localStorage.setItem("transactions", JSON.stringify(transactions));

            showNotification("Transaksi berhasil diproses.", "success");
            renderTransactionHistory();
        });

        // Render Transaction History
        function renderTransactionHistory() {
            const transactionHistory = document.getElementById("transactionHistory");
            transactionHistory.innerHTML = "";
            transactions.forEach((transaction, index) => {
                const li = document.createElement("li");
                li.className = "list-group-item";
                li.innerHTML = `
                    Produk: ${transaction.product.name} <br>
                    Jumlah: ${transaction.quantity} <br>
                    Total: Rp${transaction.totalPrice} <br>
                    Metode Pembayaran: ${transaction.paymentMethod} <br>
                    Tanggal: ${transaction.date}
                `;
                transactionHistory.appendChild(li);
            });
        }

        // Generate Report
        document.getElementById("generateReportButton").addEventListener("click", () => {
            const reportByCategory = document.getElementById("reportByCategory").value;
            let filteredProducts;

            if (reportByCategory === "all") {
                filteredProducts = products;
            } else {
                filteredProducts = products.filter(p => p.category === reportByCategory);
            }

            generateReport(filteredProducts);
        });

        function generateReport(data) {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Nama Produk,Kategori,Harga,Jumlah,Total\n";
            data.forEach(product => {
                const totalPrice = product.price * product.quantity;
                csvContent += `${product.name},${product.category},${product.price},${product.quantity},${totalPrice}\n`;
            });

            const encodedUri = encodeURI(csvContent);
            const downloadAnchor = document.createElement("a");
            downloadAnchor.href = encodedUri;
            downloadAnchor.download = "Laporan_Produk.csv";
            document.body.appendChild(downloadAnchor);
            downloadAnchor.click();
            document.body.removeChild(downloadAnchor);
        }

        // Print Receipt
        document.getElementById("printReceiptButton").addEventListener("click", () => {
            const transactionList = transactions.map(transaction => {
                return `
                    Produk: ${transaction.product.name} <br>
                    Jumlah: ${transaction.quantity} <br>
                    Total: Rp${transaction.totalPrice} <br>
                    Metode Pembayaran: ${transaction.paymentMethod} <br>
                    Tanggal: ${transaction.date} <br><br>
                `;
            }).join("");

            const receiptContent = `
                <h4>Struk Transaksi</h4>
                ${transactionList}
                <p>Total: Rp${transactions.reduce((acc, t) => acc + t.totalPrice, 0)}</p>
            `;

            const receiptWindow = window.open('', 'Print Receipt');
            receiptWindow.document.write(receiptContent);
            receiptWindow.document.write('<button onclick="window.print()">Cetak</button>');
            receiptWindow.document.write('<button onclick="window.close()">Tutup</button>');
            receiptWindow.document.close();
        });

        // Render All UI Components
        renderSupplierList();
        renderProductSelect();
        renderTransactionHistory();
    </script>
</body>
</html>
